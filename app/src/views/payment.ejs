<!DOCTYPE html>
<html lang="ko">
<head>
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@600&display=swap" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="stylesheet" type="text/css" href="/css/payment.css">


    <title>Payment</title>
</head>
<header>
    <base href="/" />
</header>
<body>
    <div class="payment-container">
        <div class="header">ğŸ’³Payment</div>
        <div class="information-container">
            <div class="information">
                â—½ ì°¨ëŸ‰ ë²ˆí˜¸ <%= carNumber %><br>
                â—½ ì£¼ì°¨ ì‹œê°„ <%= time %><br>
                â—½ ì´ ê¸ˆì•¡ <span id="total-price"><%= totalprice %></span>
                <hr>
                <div class="discount-container">
                    â—½ í• ì¸ ë°©ë²• 
                    <select id="discount-select" onchange="selectDiscount()">
                        <option selected>í• ì¸ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”!</option>
                        <option>ì—†ìŒ</option>
                        <option>ì˜í™”í‹°ì¼“</option>
                        <option>ì €ê³µí•´ì°¨ëŸ‰</option>
                    </select><br>
                </div>
                <hr>
                <div class="final-amount">â—½ ìµœì¢… ê¸ˆì•¡ <a id="final-amount"></a></div>
                <hr>
                â—½ ê²°ì œ ë°©ë²•
                <select id="payment-select" onchange="selectPayment()">
                    <option selected>ê²°ì œ ìˆ˜ë‹¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”!</option>
                    <option>í˜„ê¸ˆ</option>
                    <option>ì¹´ë“œ</option>    
                    <option>ì‚¼ì„±í˜ì´</option>
                </select><br>
                â—½ í˜„ê¸ˆ&nbsp;<span id="cash"></span><br>
                â—½ ê±°ìŠ¤ë¦„ëˆ&nbsp;<span id="change"></span><br>
                <button class="payment-btn">ê²°ì œí•˜ê¸°</button>
            </div>
        </div>
    </div>
    <script>

        function selectDiscount() {
            let totalprice = $('#total-price').text();
            let finalPrice = 0;
            console.log('total: ' , totalprice);
            if ($('#discount-select option:selected').val() === "ì˜í™”í‹°ì¼“"){
                finalPrice = totalprice - 5000
                if (totalprice <= 5000) {
                    finalPrice = 0;
                }
            } else if ($('#discount-select option:selected').val() === "ì €ê³µí•´ì°¨ëŸ‰"){
                finalPrice = totalprice / 2;
            } else if ($('#discount-select option:selected').val() === "ì—†ìŒ"){
                finalPrice = totalprice;
            }
            $('#final-amount').val(finalPrice);
            $('#final-amount').html(finalPrice);
        }

        function selectPayment() { 
            if ($('#payment-select option:selected').val() === "í˜„ê¸ˆ") {
                $('#cash').html(`<input id="cash-amount"></input><button id="send-cash-btn" onclick="showChange()">í™•ì¸</button>`);
            } else if ($('#payment-select option:selected').val() === "ì¹´ë“œ" || $('#payment-select option:selected').val() === "ì‚¼ì„±í˜ì´") {
                $('#cash').html('');
                $('#change').html('');
            }
        }

        function showChange() {
        console.log("final-amount:", $('#final-amount').val())
        console.log("cash-amount:",$('#cash-amount').val());
        let change = $('#cash-amount').val() - $('#final-amount').val();
        if (Number($('#cash-amount').val()) >= Number($('#final-amount').val())) {
            $('#change').html(change)
            $('#payment-btn').prop("disabled", false);
        } else if (Number($('#cash-amount').val()) < Number($('#final-amount').val())){
            console.log("í˜„ê¸ˆ ë¶€ì¡±");
            $('#change').html('í˜„ê¸ˆì„ ë” ë„£ì–´ì£¼ì„¸ìš”')
            $('#payment-btn').prop("disabled", true);
            }
        }

    </script>
    <script src="/js/payment.js"></script>
</body>
</html>